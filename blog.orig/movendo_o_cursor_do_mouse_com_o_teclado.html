<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Blogue do Caloni</title>
<meta name="author" content="Caloni" />
<meta name="generator" content="https://github.com/caloni/journal">
<meta property="og:title" content="Blogue do Caloni"/>
<meta property="og:type" content="website"/>
<meta property="og:url" content="http://www.caloni.com.br"/>
<meta property="og:image" content="/blog/img/about-brand.png"/>
<meta property="og:description" content="Write for computers, people and food."/>
<link href="/blog/index.xml" rel="feed" type="application/rss+xml" title="Blogue do Caloni"/>
<link rel="stylesheet" type="text/css" href="/blog/css/custom.css"/>
<link rel="stylesheet" type="text/css" href="/blog/css/jquery-ui.css"/>
<script src="/blog/js/jquery-1.12.4.js"></script>
<script src="/blog/js/jquery-ui.js"></script>
<script src="/blog/js/copy_clipboard.js"></script>
<script src="/blog/js/list.js"></script>
<link rel="icon" href="/blog/img/favicon.ico"/>
</head>
<body style="min-height:100vh;display:flex;flex-direction:column">
<nav class="navbar has-shadow is-white"
role="navigation" aria-label="main navigation">
<div class="container">
<div class="navbar-brand">
&nbsp;
<a class="navbar-item" href="index.html">
<div class="is-4"><b>Blogue do Caloni</b></div>
</a>
</div>
</div>
</nav>
<div class="container">
<div class="column">
<div style="min-height:56vh">
<div style="padding-bottom: 1em;"></div>
<span id="movendo_o_cursor_do_mouse_com_o_teclado" title="Movendo o cursor do mouse com o teclado"/></span>
<section id="section_movendo_o_cursor_do_mouse_com_o_teclado">
<p class="title">Movendo o cursor do mouse com o teclado</p>
<span class="title-heading">Caloni, 2007-07-26 computer projects blog</span>

<p>Bom, vamos deixar de papo furado e "codar". Para essa primeira tentativa iremos desenvolver um programa que move o cursor do mouse quando pressionada uma tecla de atalho e voltar à sua posição original quando pressionada outra tecla.</p>

<p>Como eu já havia dito anteriormente, uso o mouse quando necessário. Quando ele não é necessário ele fica clicando inconscientemente no Windows Explorer, já que utilizo a configuração de clique único, onde as pastas e arquivos ficam selecionáveis apenas pousando o cursor sobre eles. Eu gosto dessa configuração, exceto pelo comportamento desagradável que ocorre quando mudo para a janela do Windows Explorer e meu mouse ganha vida própria, selecionando alguma pasta ou arquivo e mudando meu foco de seleção.</p>

<p>Portanto, o objetivo desse programa é simples e direto: mover o mouse para um canto enquanto eu uso meu teclado. Nada mais, nada menos. Para isso iremos registrar alguns atalhos globais no Windows. Para registrar atalhos globais no Windows utilizamos a função do Windows API RegisterHotKey e é o que estou usando no código. O importante aqui é saber que iremos ser avisados do pressionamento das teclas que registrarmos por meio dessa função através do loop de mensagens da thread que chamar a função.</p>

<p>Um loop de mensagens é a maneira definida pelo Windows para avisar as aplicações dos eventos que ocorrerem no sistema que são relevantes para as suas janelas. Teremos chance de observar isso mais vezes, mas por enquanto basta ter uma visão geral do fluxo de mensagens que ocorre quando digitarmos a nossa tecla de atalho.</p>

<img src="/blog/img/movendo_o_cursor_do_mouse_com_o_teclado_windows_loop_mensagens_input.gif"/>

<p>O código não tem muitos segredos (update 2026-01-27: mas eu não sei onde ele foi parar; por isso pedi para o Chat-GPT fazer um novo, onde ele gentilmente implementou a leitura inclusive das hotkeys no arquivo ini). Para registrar os atalhos, usamos a função RegisterHotKey. Para manipular os eventos usamos o tal loop de mensagens e manipulamos a mensagem WM_HOTKEY de acordo com a tecla pressionada. Para mover o mouse usamos a função SetCursorPos (e para armazenar a posição atual GetCursorPos). Por fim, para ler configurações de um .ini usamos a função GetPrivateProfileInt.</p>

<pre>
#include &lt;windows.h&gt;
#include &lt;string&gt;
#include &lt;map&gt;
#include &lt;iostream&gt;
using namespace std;
// global state
//
POINT g_OldPos = { 0 };
bool g_Hidden = false;
int g_DisableX = 0;
int g_DisableY = 0;
// hotkeys IDs
#define HK_HIDE  1
#define HK_SHOW  2
#define HK_EXIT  3
// utilities
//
pair&lt;UINT, UINT&gt; ParseHotkey(const string&amp; text)
{
    UINT mod = 0;
    UINT vk = 0;
    string s = text;
    for (auto&amp; c : s) c = toupper(c);
    if (s.find(&quot;WIN+&quot;) != string::npos) mod |= MOD_WIN;
    if (s.find(&quot;CTRL+&quot;) != string::npos) mod |= MOD_CONTROL;
    if (s.find(&quot;ALT+&quot;) != string::npos) mod |= MOD_ALT;
    if (s.find(&quot;SHIFT+&quot;) != string::npos) mod |= MOD_SHIFT;
    if (s.find(&quot;DEL&quot;) != string::npos) vk = VK_DELETE;
    else if (s.find(&quot;INS&quot;) != string::npos) vk = VK_INSERT;
    else if (s.find(&quot;END&quot;) != string::npos) vk = VK_END;
    else if (s.find(&quot;HOME&quot;) != string::npos) vk = VK_HOME;
    else if (s.find(&quot;F1&quot;) != string::npos) vk = VK_F1;
    else if (s.find(&quot;F2&quot;) != string::npos) vk = VK_F2;
    else
        vk = s.back(); // fallback: última letra
    return { mod, vk };
}
string ReadIniString(const char* section, const char* key, const char* def)
{
    char buf[128];
    GetPrivateProfileStringA(section, key, def, buf, sizeof(buf), &quot;HideCursor.ini&quot;);
    return buf;
}
// mouse logic
//
void HideMouse()
{
    if (!g_Hidden)
    {
        GetCursorPos(&amp;g_OldPos);
        SetCursorPos(g_DisableX, g_DisableY);
        g_Hidden = true;
        cout &lt;&lt; &quot;[+] Mouse hidden\n&quot;;
    }
}
void ShowMouse()
{
    if (g_Hidden)
    {
        SetCursorPos(g_OldPos.x, g_OldPos.y);
        g_Hidden = false;
        cout &lt;&lt; &quot;[+] Mouse restored\n&quot;;
    }
}
int main()
{
    cout &lt;&lt; &quot;HideCursor - keyboard mouse control\n&quot;;
    // ini reading
    g_DisableX = GetPrivateProfileIntA(&quot;HideCursor&quot;, &quot;DisableX&quot;, 600, &quot;HideCursor.ini&quot;);
    g_DisableY = GetPrivateProfileIntA(&quot;HideCursor&quot;, &quot;DisableY&quot;, 0, &quot;HideCursor.ini&quot;);
    string hkHide = ReadIniString(&quot;Hotkeys&quot;, &quot;Hide&quot;, &quot;WIN+DEL&quot;);
    string hkShow = ReadIniString(&quot;Hotkeys&quot;, &quot;Show&quot;, &quot;WIN+INS&quot;);
    string hkExit = ReadIniString(&quot;Hotkeys&quot;, &quot;Exit&quot;, &quot;WIN+END&quot;);
    auto [modHide, vkHide] = ParseHotkey(hkHide);
    auto [modShow, vkShow] = ParseHotkey(hkShow);
    auto [modExit, vkExit] = ParseHotkey(hkExit);
    // register global hotkeys
    RegisterHotKey(NULL, HK_HIDE, modHide, vkHide);
    RegisterHotKey(NULL, HK_SHOW, modShow, vkShow);
    RegisterHotKey(NULL, HK_EXIT, modExit, vkExit);
    cout &lt;&lt; &quot;Hotkeys:\n&quot;;
    cout &lt;&lt; &quot; Hide: &quot; &lt;&lt; hkHide &lt;&lt; endl;
    cout &lt;&lt; &quot; Show: &quot; &lt;&lt; hkShow &lt;&lt; endl;
    cout &lt;&lt; &quot; Exit: &quot; &lt;&lt; hkExit &lt;&lt; endl;
    // message loop
    MSG msg;
    while (GetMessage(&amp;msg, NULL, 0, 0))
    {
        if (msg.message == WM_HOTKEY)
        {
            switch (msg.wParam)
            {
            case HK_HIDE:
                HideMouse();
                break;
            case HK_SHOW:
                ShowMouse();
                break;
            case HK_EXIT:
                cout &lt;&lt; &quot;Exiting...\n&quot;;
                goto exit_loop;
            }
        }
    }
exit_loop:
    UnregisterHotKey(NULL, HK_HIDE);
    UnregisterHotKey(NULL, HK_SHOW);
    UnregisterHotKey(NULL, HK_EXIT);
    return 0;
}
</pre>
<p>Abaixo um exemplo do arquivo ini:</p>

<pre>
[HideCursor]
DisableX=600
DisableY=0
[Hotkeys]
Hide=WIN+DEL
Show=WIN+INS
Exit=WIN+END
</pre>
<p>Você acha que os atalhos "WinKey + Del", "WinKey + Insert" e "WinKey + End" foram uma má escolha para essa função de esconder o mouse? Concordo. Fiz de propósito. Que tal customizar o programa para que as teclas sejam lidas do arquivo de configuração HideCursor.ini?</p>

</section>

<span style="float: left;">
 <a href="c_and_c++_operators_precedence_table.html">[c_and_c++_operators_precedence_table]</a>
 <a href="antidebug_interpretacao_baseada_em_excecao_parte_1.html">[antidebug_interpretacao_baseada_em_excecao_parte_1]</a>
</span>
</div>
</div>
</section>
<footer class="footer">
<div class="container">
</div>
<div class="intentionally-blank"></div>
</footer>
</body>
</html>
