<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Jornal do Caloni</title>
<meta name="author" content="Caloni" />
<meta name="generator" content="https://github.com/caloni/journal">
<meta property="og:title" content="Jornal do Caloni"/>
<meta property="og:type" content="website"/>
<meta property="og:url" content="http://www.caloni.com.br"/>
<meta property="og:image" content="/journal/img/about-brand.png"/>
<meta property="og:description" content="Write for computers, people and food."/>
<link href="/journal/index.xml" rel="feed" type="application/rss+xml" title="Jornal do Caloni"/>
<link rel="stylesheet" type="text/css" href="/journal/css/custom.css"/>
<link rel="stylesheet" type="text/css" href="/journal/css/jquery-ui.css"/>
<script src="/journal/js/jquery-1.12.4.js"></script>
<script src="/journal/js/jquery-ui.js"></script>
<script src="/journal/js/copy_clipboard.js"></script>
<script src="/journal/js/list.js"></script>
<link rel="icon" href="/journal/img/favicon.ico"/>
</head>
<body style="min-height:100vh;display:flex;flex-direction:column">
<nav class="navbar has-shadow is-white"
role="navigation" aria-label="main navigation">
<div class="container">
<div class="navbar-brand">
&nbsp;
<a class="navbar-item" href="months.html">
<div class="is-4"><b>Jornal do Caloni</b></div>
</a>
</div>
</div>
</nav>
<div class="container">
<div class="column">
<div style="min-height:56vh">
<div style="padding-bottom: 1em;"></div>
<ul style="list-style: none;">

<li><small><a href="2008-09.html#serenidade">Serenidade</a></small></li>
<li><small><a href="2008-09.html#de_volta_a_tona">De volta à tona</a></small></li>
<li><small><a href="2008-09.html#bug_no_retorno_do_pathisdirectory">Bug no retorno do PathIsDirectory</a></small></li>
<li><small><a href="2008-09.html#todo_programador_e_um_filosofo_em_potencial">Todo programador é um filósofo em potencial</a></small></li>
<li><small><a href="2008-09.html#reuna_seus_comandos_mais_usados_no_windbg_com_cmdtree">Reúna seus comandos mais usados no WinDbg com .cmdtree</a></small></li>
<li><small><a href="2008-09.html#v">V</a></small></li>
<li><small><a href="2008-09.html#windows_jobs_com_completion_port">Windows Jobs com Completion Port</a></small></li>
<li><small><a href="2008-09.html#cnasi_geracao_y_e_seus_gastos_em_ti">Cnasi, geração Y e seus gastos em TI</a></small></li></ul>

<span id="serenidade" title="Serenidade"/></span>
<section id="section_serenidade">
<p class="title"><a href="2008-09.html#serenidade">#</a> Serenidade</p>
<span class="title-heading">Caloni, 2008-09-01 <a href="2008-08.html#perdao">&lt;</a><a href="quotes.html">quotes</a><a href="2008-10.html#nao_manifesto">&gt;</a> <a href="2008-08.html#perdao">&lt;</a><a href="self.html">self</a><a href="2008-10.html#nao_manifesto">&gt;</a> <a href="2008-08.html#perdao">&lt;</a><a href="now.html">now</a><a href="2008-10.html#nao_manifesto">&gt;</a><a href="2008-09.html"> <sup>[up]</sup></a> <a href="javascript:;" onclick="copy_clipboard('section#section_serenidade')"><sup>[copy]</sup></a></span>

<blockquote>Tome consciência da serenidade; quando você voltar ao pensamento, ele será novo e criativo.</blockquote>

<blockquote>Tolle, Eckhart (O Poder do Agora, 1997)</blockquote>
</section><hr/>


<span id="de_volta_a_tona" title="De volta à tona"/></span>
<section id="section_de_volta_a_tona">
<p class="title"><a href="2008-09.html#de_volta_a_tona">#</a> De volta à tona</p>
<span class="title-heading">Caloni, 2008-09-07<a href="2008-09.html"> <sup>[up]</sup></a> <a href="javascript:;" onclick="copy_clipboard('section#section_de_volta_a_tona')"><sup>[copy]</sup></a></span>

<p>Depois dessas duas semanas de férias forçadas volto a escrever-vos neste humilde blogue. Houve um pequeno problema com o script que insere um arquivo de código-fonte dentro da página e ele comeu todos os meus bits disponíveis por mês na hospedagem do saite.</p>

<p>Entre os próximos artigos estão um bug na função PathIsDirectory, algumas traduções não-ortodoxas para handle, thread e dead lock, a estrutura dos códigos de erro do Windows e algumas ruminações sobre como fazer um script de build.</p>

<p>Até lá.</p>

</section><hr/>


<span id="bug_no_retorno_do_pathisdirectory" title="Bug no retorno do PathIsDirectory"/></span>
<section id="section_bug_no_retorno_do_pathisdirectory">
<p class="title"><a href="2008-09.html#bug_no_retorno_do_pathisdirectory">#</a> Bug no retorno do PathIsDirectory</p>
<span class="title-heading">Caloni, 2008-09-10 <a href="2008-08.html#os_processosfantasma">&lt;</a><a href="computer.html">computer</a><a href="2008-09.html#reuna_seus_comandos_mais_usados_no_windbg_com_cmdtree">&gt;</a> <a href="2008-08.html#os_processosfantasma">&lt;</a><a href="blog.html">blog</a><a href="2008-09.html#todo_programador_e_um_filosofo_em_potencial">&gt;</a><a href="2008-09.html"> <sup>[up]</sup></a> <a href="javascript:;" onclick="copy_clipboard('section#section_bug_no_retorno_do_pathisdirectory')"><sup>[copy]</sup></a></span>

<p>Estava eu outro dia programando aquele código esperto "para ontem" quando me deparei com uma situação no mínimo inusitada. Ao testar se um caminho recebido era de fato um diretório me foi retornado pela API um valor diferente de TRUE. E diferente de FALSE!</p>

<p>De acordo com a documentação, o retorno deveria ser TRUE caso o caminho enviado à função fosse de fato um diretório. Caso contrário, o retorno deveria ser FALSE.</p>

<p>Note que existem apenas dois valores possíveis para essa função. Porém, o valor retornado não é 1, o equivalente ao define TRUE, mas sim 0x10 (16 em hexadecimal). O simples exemplo abaixo deve conseguir reproduzir a situação (Windows XP Service Pack 3):</p>

<pre>
   Setting environment for using Microsoft Visual Studio 2008 x86 tools.
   C:\Tests&gt;copy con IsPathDir.cpp
   #include &lt;shlwapi.h&gt;
   #include &lt;windows.h&gt;
   #include &lt;stdio.h&gt;
   #pragma comment(lib, &quot;shlwapi.lib&quot;)
   int main()
   {
           BOOL isDir = PathIsDirectory(&quot;C:\\Tests&quot;); // obs.: diretorio TEM que existir
           printf(&quot;Resultado: %d.\n&quot;, isDir);
   }^Z
           1 arquivo(s) copiado(s).
   C:\Tests&gt;cl IsPathDir.cpp
   Microsoft (R) 32-bit C/C++ Optimizing Compiler Version 15.00.21022.08 for 80x86
   Copyright (C) Microsoft Corporation.  All rights reserved.
   IsPathDir.cpp
   Microsoft (R) Incremental Linker Version 9.00.21022.08
   Copyright (C) Microsoft Corporation.  All rights reserved.
   /out:IsPathDir.exe
   IsPathDir.obj
   C:\Tests&gt;IsPathDir.exe
   Resultado: 16.
</pre>
<p>Isso quer dizer apenas que o código abaixo vai funcionar,</p>

<pre>
   if( PathIsDirectory(path) ) // legal: qualquer coisa diferente de zero
</pre>
<p>o código abaixo vai funcionar</p>

<pre>
   if( ! PathIsDirectory(path) ) // legal: se der zero (FALSE), OK
</pre>
<p>e o código abaixo não vai funcionar:</p>

<pre>
   if( PathIsDirectory(path) == TRUE ) // vixi: TRUE nem sempre é o resultado
</pre>
<p>E, pior, o código abaixo também não vai funcionar!</p>

<pre>
   if( PathIsDirectory(path) != TRUE ) // aff... é bom rever os seus conceitos
</pre>
<p>Pesquisando um pouco descobri uma boa discussão sobre o tema, e inclusive que outras pessoas descobriram o interessante detalhe que para pastas normais o retorno é 0x10, mas para compartilhamentos o retorno é 0x1.</p>

<h4>O bug atrás dos documentos</h4>

<p>O problema ocorre por causa da maneira que a função determina se o caminho é um diretório ou não. Uma simples vistoria sobre a função nos revela o detalhe crucial:</p>

<pre>
   C:\Tests&gt;cl /Zi IsPathDir.cpp
   Microsoft (R) 32-bit C/C++ Optimizing Compiler Version 15.00.21022.08 for 80x86
   Copyright (C) Microsoft Corporation.  All rights reserved.
   IsPathDir.cpp
   Microsoft (R) Incremental Linker Version 9.00.21022.08
   Copyright (C) Microsoft Corporation.  All rights reserved.
   /out:IsPathDir.exe
   /debug
   IsPathDir.obj
   C:\Tests&gt;cdb IsPathDir.exe
   Microsoft (R) Windows Debugger Version 6.8.0004.0 X86
   Copyright (c) Microsoft Corporation. All rights reserved.
   CommandLine: IsPathDir.exe
   Symbol search path is: SRV*c:\symbols*http://msdl.microsoft.com/download/symbols
   ...
   ntdll!DbgBreakPoint:
   7c901230 cc              int     3
   0:000&gt; g shlwapi!PathIsDirectoryA
   eax=009836e0 ebx=7ffde000 ecx=00000001 edx=00422828 esi=0006f4cc edi=7c911970
   eip=77ee7538 esp=0012ff6c ebp=0012ff78 iopl=0         nv up ei pl zr na pe nc
   cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
   SHLWAPI!PathIsDirectoryA:
   77ee7538 8bff            mov     edi,edi
   0:000&gt; p
   push    ebp
   mov     ebp,esp
   sub     esp,20Ch
   mov     eax,dword ptr [SHLWAPI!__security_cookie
   push    esi
   mov     esi,dword ptr [ebp+8] ss:0023:0012ff70=0041dc5c
   test    esi,esi
   mov     dword ptr [ebp-4],eax ss:0023:0012ff64=fffffffe
   je      SHLWAPI!PathIsDirectoryA+0xb2 (77ee75ea) [br=0]
   push    esi
   call    SHLWAPI!PathIsUNCServerA (77ec35b9)
   test    eax,eax
   jne     SHLWAPI!PathIsDirectoryA+0xb2 (77ee75ea) [br=0]
   push    esi
   call    SHLWAPI!PathIsUNCServerShareA (77ee737d)
   test    eax,eax
   je      SHLWAPI!PathIsDirectoryA+0xc1 (77ee75f9) [br=1]
   push    esi
   call    dword ptr [SHLWAPI!_imp__GetFileAttributesA (77ea11d4)]
   cmp     eax,0FFFFFFFFh
   ...
</pre>
<p>Ou seja, para pastas locais a função simplesmente usa a conhecidíssima GetFileAttributes, que retorna o flag 0x10 setado caso se trate de uma pasta, de acordo com a documentação: "The attributes can be one or more of the following values:"</p>

<ul><li>FILE_ATTRIBUTE_ARCHIVE 32 (0x20) A file or directory that is an archive file or directory.</li>

<li>FILE_ATTRIBUTE_COMPRESSED 2048 (0x800) A file or directory that is compressed.</li>

<li>FILE_ATTRIBUTE_DIRECTORY 16 (0x10) The handle that identifies a directory.</li></ul>

<p>Aqui termina nossa dúvida sobre o pequenino bug na documentação. E isso nos lembra também que é sempre bom comparar as coisas da melhor maneira possível. E essa melhor maneira em se tratando de ifs é supor apenas dois valores binário: ou é zero ou é não-zero.</p>

</section><hr/>


<span id="todo_programador_e_um_filosofo_em_potencial" title="Todo programador é um filósofo em potencial"/></span>
<section id="section_todo_programador_e_um_filosofo_em_potencial">
<p class="title"><a href="2008-09.html#todo_programador_e_um_filosofo_em_potencial">#</a> Todo programador é um filósofo em potencial</p>
<span class="title-heading">Caloni, 2008-09-12 <a href="2008-05.html#read_the_functional_manual">&lt;</a><a href="essays.html">essays</a><a href="2008-10.html#a_alca_dentro_do_fio_gerou_um_bloqueio_da_morte">&gt;</a> <a href="2007-06.html#a_inteligencia_do_if_parte_2">&lt;</a><a href="philosophy.html">philosophy</a><a href="2016-11.html#o_mundo_de_sofia">&gt;</a> <a href="2008-09.html#bug_no_retorno_do_pathisdirectory">&lt;</a><a href="blog.html">blog</a><a href="2008-09.html#windows_jobs_com_completion_port">&gt;</a><a href="2008-09.html"> <sup>[up]</sup></a> <a href="javascript:;" onclick="copy_clipboard('section#section_todo_programador_e_um_filosofo_em_potencial')"><sup>[copy]</sup></a></span>

<p>Tivemos uma conversa muito frutífera hoje durante o almoço ao conhecer uma professora que sentava ao nosso lado, exímia conhecedora da mente humana e amante das artes nobres como a filosofia e a lógica. O importante dessa colóquio foi ter encontrado um motivo muito mais forte para gostar de programação do que qualquer outro que já me surgira na cabeça desde que mexo com essas coisas: O computador não deve dar ordens ao homem e este repeti-las como uma máquina. O homem, como ser pensante, deve dizer ao computador o que fazer, e este responder-lhe diligentemente.</p>

<p>Para resumir desde o começo essa conclusão, um exemplo paupável: quando fazemos um curso de treinamento, uma especialização, uma faculdadeZINHA ou qualquer outro evento de "aprendizado" que nos propõe a digitar comandos sem fim, repetidamente para um computador, para no final ganharmos um comprovante de que sabemos digitar aqueles comandos decorados e repetitivos como ninguém, isso quer dizer que as coisas vão mal, se e quando tudo se resume a isso.</p>

<p>Por outro lado, ao aprendermos, por nós mesmos ou pelos outros, a usar o computador como a ferramenta que vai fazer de nossas idéias realidade, e nossas criações se materializam de uma forma inimitável, então, somos criadores e comandantes da máquina, e não uma cópia de uma máquina que repete comandos. Então, nesse caso, temos um motivo para viver: criar sempre coisas novas e interessantes que surgem em nossas cabeças.</p>

<p>E ser feliz é isso: achar significado para o que fazemos. É criar. Pura e simplesmente. Quem está sempre criando está sempre satisfeito com sua vida. Pois dá sentido a ela todo santo dia. Isso vale para qualquer profissão interessante o suficiente. Não precisa fazer código. Pode construir móveis, ensinar pessoas ou desenhar uma nova peça de roupa.</p>

<p>Criar é pensar. Programadores pensam em coisas novas todos os dias e as executam. Quando encontram algo repetitivo, organizam o código para não terem que repetir mais a mesma baboseira e voltam a fazer coisas interessantes e originais. Se existe um processo enfadonho e chato, o programador inventa um jeito para o computador fazê-lo, e não ele. E a vida do programador sempre gira em torno desse ciclo: dispensa as coisas chatas mandando o computador fazer e se dedica a fazer coisas novas.</p>

<p>A discussão não parou por aí, pois me levou a entender o vazio que eu sinto ao estudar coisas que não uso nunca. Porque aprender por aprender não vai me levar a lugar algum. Pode até ser perigoso ler livros longos, ricos em detalhes e que fazem perder o fio da meada ao terminá-lo. Faz parecer inútil.</p>

<p>Também me mostra que mais vale a pena aprender a pensar, ou pensar melhor, do que aprender uma nova tecnologia em um livro recém-lançado de 1500 páginas. Quando aprendemos a pensar resolvemos os problemas por nós mesmos, e não por uma formulazinha mágica tirada do saite favorito de bricabraques.</p>

<p>Ser programador é criar. Criar é bom. Criar nos faz felizes.</p>

<p>E é por isso, realmente, que amo o que eu faço.</p>

</section><hr/>


<span id="reuna_seus_comandos_mais_usados_no_windbg_com_cmdtree" title="Reúna seus comandos mais usados no WinDbg com .cmdtree"/></span>
<section id="section_reuna_seus_comandos_mais_usados_no_windbg_com_cmdtree">
<p class="title"><a href="2008-09.html#reuna_seus_comandos_mais_usados_no_windbg_com_cmdtree">#</a> Reúna seus comandos mais usados no WinDbg com .cmdtree</p>
<span class="title-heading">Caloni, 2008-09-19 <a href="2008-09.html#bug_no_retorno_do_pathisdirectory">&lt;</a><a href="computer.html">computer</a><a href="2008-09.html#windows_jobs_com_completion_port">&gt;</a><a href="2008-09.html"> <sup>[up]</sup></a> <a href="javascript:;" onclick="copy_clipboard('section#section_reuna_seus_comandos_mais_usados_no_windbg_com_cmdtree')"><sup>[copy]</sup></a></span>

<p>Tudo começou com o <a href="https://docs.microsoft.com/en-us/archive/blogs/debuggingtoolbox/special-commandexecute-commands-from-a-customized-user-interface-with-cmdtree">artigo de Roberto Farah</a> sobre o comando "escondido" do WinDbg .cmdtree. Logo depois meus outros colegas do fã-clube do WinDbg <a href="http://voneinem-windbg.blogspot.com/2008/09/amazing-helper-cmdtree.html">Volker von Einem</a> e <a href="http://www.dumpanalysis.org/blog/index.php/2008/09/18/cmdtreetxt-for-cda-checklist/">Dmitry Vostokov</a> comentaram sobre a imensa utilidade desse comando. E não é pra menos. É de longe o melhor comando não-documentado do ano. Tão bom que sou obrigado a comentar em português sobre ele, apesar dos três artigos já citados.</p>

<h4>Comandos repetitivos</h4>

<p>E eu estava justamente falando sobre essa mania dos programadores sempre acharem soluções para tarefas repetitivas e monótonas que o computador possa fazer sozinho.O comando .cmdtree é uma dessas soluções, pois possibilita ao depurador profissional juntar em uma só guia o conjunto de comandos mais usados por ele no dia-a-dia, por mais bizarros e com mais parâmetros que eles sejam, já que é possível representá-los por um alias (apelido):</p>

<pre>
   windbg ANSI Command Tree 1.0
   title {&quot;Meus Comandos Comuns&quot;}
   body
   {&quot;Comandos Comuns&quot;}
    {&quot;Subsecao&quot;}
     {&quot;Breakpoint no inicio do programa&quot;} {&quot;bp @$exentry&quot;}
     {&quot;GetLastError&quot;} {&quot;!gle&quot;}
</pre>
<p>O resultado:</p>

<img src="/journal/img/reuna_seus_comandos_mais_usados_no_windbg_com_cmdtree_cmdtree.png"/>

<p>E podemos usar essa janela no nosso WinDbg, cada vez mais bonitinho e cada vez mais <a href="http://pt.wikipedia.org/wiki/Wysiwyg">WYSIWYG</a>:</p>

<img src="/journal/img/reuna_seus_comandos_mais_usados_no_windbg_com_cmdtree_cmdtree2.png"/>

<p>Realmente não há segredos em seu uso. Esse artigo foi apenas um patrocínio do clube do WinDbg.</p>

</section><hr/>


<span id="v" title="V"/></span>
<section id="section_v">
<p class="title"><a href="2008-09.html#v">#</a> V</p>
<span class="title-heading">Caloni, 2008-09-23 <a href="2008-06.html#resultado_do_seminario_ccpp">&lt;</a><a href="ccppbr.html">ccppbr</a><a href="2008-10.html#impressoes_do_quinto_encontro_de_ccpp">&gt;</a><a href="2008-09.html"> <sup>[up]</sup></a> <a href="javascript:;" onclick="copy_clipboard('section#section_v')"><sup>[copy]</sup></a></span>

<p>Parabéns a todos que participaram e ajudaram para que todos nós chegássemos ao quinto encontro de programadores/aficionados C/C++. Parece mentira, mas hoje temos capacidade para lotar um auditório razoável, e temos a ousadia de sempre poder contar com uma grade de palestras pra lá de avançadas. Vejamos o que foi visto até hoje nesses últimos três encontros (III, IV e o seminário):</p>

<p>  * C++ com WxWidgets</p>

<p>  * O novo padrão C++0x</p>

<p>  * Threads no C++ ISO</p>

<p>  * C e microcontroladores</p>

<p>  * Drivers para Windows</p>

<p>  * TCP/IP via Boost.Asio</p>

<p>  * C++ com Qt</p>

<p>  * Dicas de portabilidade</p>

<p>  * Programação concorrente</p>

<p>  * C++ com STL/Boost</p>

<p>  * Otimização de código</p>

<p>E esse é só o começo.</p>

<p>04 de outubro de 2008, São Paulo, Brasil</p>

<p>  * Ferramentas para programação C++ para Windows por Rodrigo Strauss</p>

<p>  * Programando com Conceitos no novo C++ por Leandro Melo</p>

<p>  * Arquivos de memória mapeada no Windows com C++ por Basílio Miranda</p>

<p>  * Explorando o Windows (Vista &amp; Server 2008) com C++ por Fábio Galuppo</p>

<p>  * Criando Linguagens Embutidas para Otimização por Felipe Almeida</p>

<p>08 de novembro de 2008, São Paulo, Brasil</p>

<p>  * Técnicas de Programação em C para Sistemas Embarcados por Daniel Quadros</p>

<p>  * Utilização de C++ em Microcontroladores por Luiz Barros</p>

<p>  * Explorando os 16 bits da Microchip e as ferramentas de trabalho por Daniel Rodrigues</p>

<p>  * Otimização de código C para sistemas embarcados por Fábio Pereira</p>

<p>  * Desenvolvimento Embedded no Mundo da eLua por Dado Sutter</p>

<p>Se repararam, o número de palestras foi acrescido de um (palestras++) e o tempo para cada uma delas foi ligeiramente encolhido. Espero que esse não seja um empecilho para o desenvolver dos assuntos, pois existem alguns bem delicados acima (como a linguagem embutida e memória mapeada) para serem explicados em cerca de uma hora.</p>

<p>É isso aí. Vida longa ao C++! (e ao C! e ao COBOL! e ao FORTRAN!)</p>

</section><hr/>


<span id="windows_jobs_com_completion_port" title="Windows Jobs com Completion Port"/></span>
<section id="section_windows_jobs_com_completion_port">
<p class="title"><a href="2008-09.html#windows_jobs_com_completion_port">#</a> Windows Jobs com Completion Port</p>
<span class="title-heading">Caloni, 2008-09-23 <a href="2008-09.html#reuna_seus_comandos_mais_usados_no_windbg_com_cmdtree">&lt;</a><a href="computer.html">computer</a><a href="2008-10.html#como_usar_wtl_com_o_atl_do_ddk">&gt;</a> <a href="2008-09.html#todo_programador_e_um_filosofo_em_potencial">&lt;</a><a href="blog.html">blog</a><a href="2008-09.html"> <sup>[up]</sup></a> <a href="javascript:;" onclick="copy_clipboard('section#section_windows_jobs_com_completion_port')"><sup>[copy]</sup></a></span>

<p>Ou "Como esperar o término de todos os processos-filho criados a partir de um conjunto de processos".</p>

<p>Dessa vez confesso que esperava um pouco mais de documentação do MSDN, ou pelo menos um sistema de referências cruzadas eficiente. Outro dia demorei cerca de duas horas para conseguir <a href="https://learn.microsoft.com/en-us/windows/win32/procthread/job-objects">criar um job</a>, anexar o processo desejado e, a pior parte, esperar que todos os processos (o principal e seus filhos e netos) terminassem.</p>

<p>Além da pouca documentação, parece que não são muitas as pessoas que fazem isso e publicam na web, ou eu <a href="http://www.google.com.br/search?q=wait+all+processes+inside+job+object">não sei procurar direito</a>.</p>

<blockquote>Update 2026-02-17: hoje você segue o link do Google acima e a IA já te explica como deve proceder. Entre no modo IA e ele te joga o código completo.</blockquote>
<p>Mas, pra início de conversa, o que é um job mesmo?</p>

<h4>Leve introdução sobre o conceito de jobs</h4>

<p>Um job é um objeto "novo" no kernel do Windows 2000 em diante, e se prontifica a suprir a carência que havia anteriormente de **controle sobre o que os processos podem fazer e por quanto tempo**.</p>

<p>A abstração mais coerente que eu consigo tirar de um job é como **um trabalho a ser executada por um ou mais processos**. O objeto job controla a criação, o término e as exceções que ocorrem dentro dele mesmo.</p>

<img src="/journal/img/windows_jobs_com_completion_port_job.gif"/>

<p>Entre as funções mais úteis de um job estão limitar o tempo de execução do conjunto de processos, o número de handles/arquivos/outros objetos abertos, limite de memória RAM ocupada e a possibilidade de terminar todos os processos de uma só vez.</p>

<p>Para informações básicas de como criar um job e anexar processos recomendo o ótimo artigo de Jeffrey Richter (se você conseguir encontrar, meu último link está quebrado).</p>

<p>No final desse artigo ele chega a citar o controle mais refinado dos processos através de uma <a href="https://learn.microsoft.com/en-us/windows/win32/fileio/i-o-completion-ports">completion port</a>, que permitirá receber eventos que ocorrem dentro de um job durante sua vida útil. Apesar de citar, não há código de exemplo que faça isso.</p>

<p>Bom, agora há:</p>

<pre>
#define _WIN32_WINNT 0x0500 // Jobs só existem do 2000 em diante
#include &lt;windows.h&gt;
/** @brief Função que cria um processo a partir de cmdLine
 * e coloca-o dentro de um job. A função aguarda o término
 * do processo e de qualquer subprocesso criado por este.
 */
DWORD CreateJobAndWait(LPSTR cmdLine)
{
   // primeiro, criamos um job sem nome
   HANDLE job = CreateJobObject(NULL, NULL);
   if( job )
   {
      STARTUPINFO si = { sizeof(si) };
      PROCESS_INFORMATION pi;
      // depois, criamos um processo suspenso (travado)
      if( CreateProcess(NULL, cmdLine, NULL, NULL, FALSE, 
         CREATE_SUSPENDED | CREATE_NEW_CONSOLE, NULL, NULL, &amp;si, &amp;pi) )
      {
         // atribuímos esse processo ao nosso jobo
         AssignProcessToJobObject(job, pi.hProcess);
         // rodamos o processo
         ResumeThread(pi.hThread);
         // essa é uma completion i/o port genérica
         // (ou seja, não relacionada com nenhum arquivo
         // ou outra completion port)
         HANDLE port = CreateIoCompletionPort(INVALID_HANDLE_VALUE, 
                 NULL, 0, 0);
         if( port )
         {
            JOBOBJECT_ASSOCIATE_COMPLETION_PORT jobPort;
            jobPort.CompletionKey = 0; // ver variável key abaixo
            jobPort.CompletionPort = port; // nossa completion port vai aqui!
            // definimos a c.p. em nosso job
            if( SetInformationJobObject(job, 
                        JobObjectAssociateCompletionPortInformation, 
                        &amp;jobPort, sizeof(jobPort)) )
            {
               ULONG_PTR key = 0; // ver membro CompletionKey acima
               LPOVERLAPPED overlap = 0;
               DWORD tranferred = 0;
               // nosso loop de mensagens com completion port
               while( GetQueuedCompletionStatus(port, &amp;tranferred, 
                  &amp;key, &amp;overlap, INFINITE) )
               {
                  // transferred especifica a mensagem
                  DWORD msg = *(LPDWORD) &amp;tranferred;
                  // significa que não existem mais processos rodando
                  if( msg == JOB_OBJECT_MSG_ACTIVE_PROCESS_ZERO )
                     break; // saímos fora
               }
            }
            CloseHandle(port); // fecha tudo
         }
         CloseHandle(pi.hThread); // fecha tudo
         CloseHandle(pi.hProcess); // fecha tudo
      }
      CloseHandle(job); // fecha tudo
   }
   return 0;
}
int main(int argc, char* argv[])
{
   if( argc == 2 )
      CreateJobAndWait(argv[1]);
}
</pre>
<p>O exemplo acima cria um processo baseado em uma linha de comando e espera pelo término do processo criado e de todos os subprocessos criados a partir do primeiro processo. Note que mesmo que o primeiro processo termine, a Completion Port só receberá o evento que todos os processos acabaram depois que o último subprocesso terminar.</p>

<p>Dessa forma, ao compilarmos o código e rodarmos mais um prompt de comando através de nosso programa ele fica travado mesmo ao fecharmos o prompt criado. O programa só será finalizado ao fecharmos o Bloco de Notas iniciado pelo segundo prompt.</p>

<p>Além desse evento, que era o que eu estava procurando, esse método permite obter outros eventos bem interessantes:</p>

<p>  * JOB_OBJECT_MSG_NEW_PROCESS. Um novo processo foi criado dentro do job.</p>

<p>  * JOB_OBJECT_MSG_EXIT_PROCESS. Um processo existente dentro do job foi terminado.</p>

<p>  * JOB_OBJECT_MSG_PROCESS_MEMORY_LIMIT. O limite de memória de um processo já foi alcançado.</p>

<p>  * JOB_OBJECT_MSG_END_OF_PROCESS_TIME. O limite de tempo de processamento de um processo já foi alcançado.</p>

<p>Enfim, jobs não terminam por aí. Dê mais uma olhada no MSDN e veja se encontra mais alguma utilidade interessante para o nosso amigo job. Eu encontrei e fiquei feliz.</p>

</section><hr/>


<span id="cnasi_geracao_y_e_seus_gastos_em_ti" title="Cnasi, geração Y e seus gastos em TI"/></span>
<section id="section_cnasi_geracao_y_e_seus_gastos_em_ti">
<p class="title"><a href="2008-09.html#cnasi_geracao_y_e_seus_gastos_em_ti">#</a> Cnasi, geração Y e seus gastos em TI</p>
<span class="title-heading">Caloni, 2008-09-25<a href="2008-09.html"> <sup>[up]</sup></a> <a href="javascript:;" onclick="copy_clipboard('section#section_cnasi_geracao_y_e_seus_gastos_em_ti')"><sup>[copy]</sup></a></span>

<p>Nosso crachá de visitantes dava direito a uma palestra. E haviam muitas. Porém, logo após a hora do almoço, das disponíveis uma era particularmente interessante, pois citava uma expressão que eu e minha colega nunca havíamos escutado: um senhor iria nos falar sobre como lidar com essas novas pessoas que estão cada vez mais invadindo nossas casas e nossos escritórios, pertencentes a esse grupinho, a tão famosa chamada geração Y.</p>

<p>Agora não sei se a culpa foi dessa tal geração Y, mas o fato é que o folhetim estava errado e caímos em uma outra palestra, essa falando sobre um tema que aí sim nós nunca tínhamos ouvido falar: como gerenciar as finanças na parte de TI da empresa.</p>

<p>O homem discursou por uma hora falando de como todos os principais frameworks de gerenciamento de custos, projetos e todas aquelas coisas, poderiam ser integrados para facilitar a vida do gestor de projetos que tem como tarefa saber o que irá continuar fazendo e o que irá cortar devido à lucratividade/risco perigosos.</p>

<p>A grande questão dessa discussão, pelo que eu pude entender, foi que os custos de um projeto e manutenção são difíceis de mensurar se não existir alguém no meio daquele bando de nerds que consiga dizer quais são os recursos usados (quem), para que (tarefa) e por quê (vantagem). Sem contar que é necessário transformar isso em dado contábil. Além de que, como bem disse nosso palestrante, a maioria das empresas ainda considera o departamento de nerds uma despesa sem vantagens. E uma despesa bem cara, se estivermos falando dos salários atualmente pagos para esse pessoal.</p>

<p>Mas vou parar por aqui antes que alguém levante a bandeira e queira discursar a respeito da justeza com que são pagas nossas mentes, um assunto muito precoce nos dias atuais. (Bom, talvez seja precoce para sempre, do jeito que a economia é ciência aberta.)</p>

<p>O fato é que acabamos subindo a rua novamente sem saber que tal de geração Y é essa que nos fez entrar na palestra errada. Como sempre, nada que uma boa "googada" não resolva.</p>

<p>Parênteses. Descobri recentemente que os seguidores do outro lado agora inventaram um novo "termo": Windows-Live-procurada. Um de seus representantes, anteriormente um homem de respeito e opiniões fortes e imparciais, acredita este ser um termo de uso corrente no dia-a-dia. </p>

<p>Pelo que pudemos encontrar, a tal da geração Y somos nós mesmo. Que espanto! E eu pensei que estávamos falando de uma raça alienígena ou algo assim. Talvez até seja, mas temos todos os genes da espécie humana.</p>

<p>Aparentemente existem estudos "sérios" nos EUA que dividem as gerações usando letras e encontrando as principais diferenças entre nós mesmos e nossos pais e avós. Como essa última geração recebeu elogios de diversas partes do estudo, a nominação de geração Y foi se estendendo ao resto do mundo, principalmente nos novos mercados de tecnologia.</p>

<p>A conclusão a que chego é que existem rótulos demais para as pessoas hoje em dia. As pessoas não podem mais ser simplesmente pessoas. Precisam ser nerds, geeks, ráquers ou geração Y. Se você não é, está de fora. Se está dentro, é antenado. Que é outro rótulo.</p>

<p>Fim de passeio. Voltamos à empresa e falamos com um outro colega sobre o que havíamos aprendido sobre o uso dos recursos no gerenciamento dos projetos no departamento de TI de uma empresa. Ele disse: "TI pra quê? Só traz despesa esse negócio."</p>

<p>E viva a geração Y!</p>

<p>Adendum. A palestra que participamos foi a "Por que implementar a gestão financeira de TI? Uma abordagem baseada no ITIL, COBIT/VAL IT, e PMBOK", e queríamos ter visto a palestra "Desafio: Como Gerenciar a Geração Y", que como pudemos ver não é tarefa fácil, já que essa geração não consegue nem entrar na palestra certa. Veja a grade do evento para mais informações.</p>

<p>Ah, sim, meu crachá de gerente. Pois então, achei superinteressante o fato de eu ter entrado em um evento de segurança portando um crachá que diz "gerente" no nome quando na verdade eu continuo sendo de fato um programador. Fui eu que disse que era gerente na entrada da feira, como um pequeno teste de acessibilidade.</p>

<p>Não que isso seja uma falha de segurança muito grave, mas imagine uma empresa suficientemente grande com pessoas mal intencionadas que foram convidadas a visitar a feira e escolheram ser gerentes ou diretores na hora de escolher o cargo. O que poderiam ter feito, em nome da empresa, dentro dessa feira? É algo a se pensar...</p>

</section><hr/>

<span style="float: left;">
 <a href="2008-08.html">[2008-08]</a>
 <a href="2008-10.html">[2008-10]</a>
</span>
</div>
</div>
</section>
<footer class="footer">
<div class="container">
</div>
<div class="intentionally-blank"></div>
</footer>
</body>
</html>
